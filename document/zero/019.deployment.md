---
title: 19. 冰刀：部署
---

> 冰缩寒流，川凝冻霭，前回鹭渚冬晚。燕阁红炉，驼峰翠釜，曾忆花柔酒软。――刘天游《氐州第一》

* 项目地址：<https://github.com/silentbalanceyh/vertx-zero-example/>

&ensp;&ensp;&ensp;&ensp;本篇为实战总结帖，主要用于多个项目同时运行时的统一文档，目前Zero上已经运行了几个比较重量级的项目，本文主要针对几个平台从环境搭建、开发、运行、测试到部署进行基于实战的讲解，以Step-By-Step的方式让开发人员能更加流程搭建Zero的企业实战开发环境。本文内容和原始教程中的内容略微有些出入，是因为引用了更多Zero Extension中的模块来辅助开发，所以此文算是Zero Core和Zero Extension的交叉参考教程。

# 「壹」开发环境

## 1.1. 基础环境介绍

&ensp;&ensp;&ensp;&ensp;最新的依赖库版本如下：

|依赖库|类型|版本|
|---|---|---|
|NodeJs|前端|16.14.0|
|Ant Design|前端|3.26.19|
|React|前端|16.14.0|
|JDK|后端|11|
|Maven|后端|3.8.5|
|Zero|后端|0.8.1 ~|
|Vertx|后端|4.2.6|
|ElasticSearch|集成（全文检索）|7.x ~|
|Neo4j|集成（拓扑图）|4.x ~|
|Camunda|集成（工作流）|7.x ~|
|MySQL|数据库|5.x|
|Oracle|数据库|12.x|
|TiDB|数据库|5.x|

&ensp;&ensp;&ensp;&ensp;**特殊说明**

* JDK的版本推荐使用ZuLu的开源JDK：<https://www.azul.com/downloads/>
* Maven推荐使用mvnd工具：<https://github.com/apache/maven-mvnd/releases>
* 如果使用了**动态建模**（zero-atom）功能，则需要根据您的数据库下载相关依赖库：<https://github.com/silentbalanceyh/vertx-zero/tree/master/vertx-pin/zero-vista>，若是其他类型数据库需参考内置源代码自己写一套基础插件。
* 集成部分的ElasticSearch、Neo4j、Camunda根据您自身项目情况而定。
* **动态建模**/**动态路由**功能根据您自身项目情况而定。
* Maven的仓库推荐使用中心仓库，以防止部分jar包无法从代理仓库下载。

&ensp;&ensp;&ensp;&ensp;本教程**假设**您的基本环境如下：

|实体|必须/可选|类型|含义|
|---|---|---|---|
|本地开发|x|工作目录|~/runtime/develop|
|Maven仓库|x|依赖库目录|~/.m2/repository|
|生产部署|x|工作目录|~/runtime/server|
|生产存储|可选|工作目录|~/runtime/zero-store/|
|`DB_DEMO`|x|数据表|数据库中的主库|
|`DB_DEMO_WF`|可选|数据表|数据库中工作流专用库（Camunda库）|
|`DB_DEMO_HIS`|可选|数据表|数据库中的删除历史库|
|`DB_XX`|可选|数据表|动态建模专用库|

&ensp;&ensp;&ensp;&ensp;**注**：可选部分根据您搭建环境过程中选择的zero extension模块进行相关定义，最新版的模块化会自动化部署相关模块已经环境内容，详细部分参考后续章节。

## 1.2. zero主框架

&ensp;&ensp;&ensp;&ensp;如果您不关注最新版的功能，直接使用`0.8.1`版本，则可**跳过该步骤**，由于zero本身是一个跟着项目成长很迅速的项目，所以在`1.0`版本发布之前，个人推荐紧跟最新版本走。虽然最新版本是`X-SNAPSHOT`，基础功能已经经过了生产环境验证，所以该版本是可靠的；再者，最新版本会包含一部分重用性极高的新功能，如`0.9.0-SNAPSHOT`中引入的：

* 文档管理平台（FTP、SSH）
* 模块化管理平台（License、Modulat）
* 工作流标准化平台（ITSM、ISO）
* WebSocket功能（正在开发中，用于提醒）
* 短信邮件集成

&ensp;&ensp;&ensp;&ensp;zero框架导入的**操作步骤**如下：

1. 进入目录`~/runtime/develop/`中，下载`vertx-zero`代码到环境中：

    ```shell
    # 由于是只读类型，所以可不带access_token的模式拉取开源代码
    ~/runtime/develop >> git clone https://github.com/silentbalanceyh/vertx-zero.git
    # 命令执行后的输出如下
    Cloning into 'vertx-zero'...
    remote: Enumerating objects: 62003, done.
    remote: Counting objects: 100% (17224/17224), done.
    remote: Compressing objects: 100% (6252/6252), done.
    remote: Total 62003 (delta 8657), reused 16131 (delta 8157), pack-reused 44779
    Receiving objects: 100% (62003/62003), 87.48 MiB | 15.39 MiB/s, done.
    Resolving deltas: 100% (35166/35166), done.
    Updating files: 100% (4850/4850), done.
    ```

2. 下载完成后`~/runtime/develop`中会有一个`vertx-zero`目录，使用IDEA导入该目录中的项目：
    * 2.1. 启动IDEA
    ![](./_image/2022-03-27-21-51-08.png)
    * 2.2. 选中下载的`vertx-zero`目录
    ![](./_image/2022-03-27-21-53-09.png)
    * 2.3. 在弹出的对话框中选择`Open as Project`（以项目方式打开）
    ![](./_image/2022-03-27-21-54-08.png)
    * 2.4. 如果弹出下边对话框，则直接勾选`Trust projects in ~/runtime/develop`，然后点击`Trust Project`
    ![](./_image/2022-03-27-21-55-28.png)
    * 2.5. 然后等待右下角的项目初始化完成
    ![](./_image/2022-03-27-21-56-25.png)
    * 2.6. 点开进度条会看到正在执行的后台任务：
    ![](./_image/2022-03-27-21-59-55.png)
    * 2.7. 项目初始化过程中，系统会下载部分所需的Maven依赖包，您的Maven库中会开始有内容（**注：如果之前您的Maven目录中已存在相关库，则可忽略，Demo从空Maven库开始初始化以方便初学者。**）：
    ![](./_image/2022-03-27-21-58-00.png)
3. 导入完成后，先检查IDE中的JDK运行环境是否符合：**File -> Project Structure...**，推荐**11**。
    ![](./_image/2022-03-27-22-16-23.png)
4. 打开Terminal终端，使用内置脚本（**mvnd环境**）编译`vertx-zero`：

    ![](./_image/2022-03-27-22-19-34.png)
    ```shell
    # zero中内置脚本主要用于快速编译以及增量编译框架，其中内容如下：
    # 1）完整编译（常用）                -- zero-compile.sh
    # 2）增量编译                       -- zero-compile-increase.sh
    # 3）「部分」编译核心框架             -- zero-compile-core.sh
    # 4）「部分」编译扩展框架             -- zero-compile-extension.sh
    # 5）「部分」编译插件                -- zero-compile-infix.sh
    # 
    ~/runtime/develop/vertx-zero(master) >> ./zero-compile.sh
    # zero-compile.sh脚本内容如下
    # mvnd clean package install -DskipTests=true -Dmaven.javadoc.skip=true -Dmaven.compile.fork=true -T 1C
    ......
    # 最终输出如下
    [INFO] ------------------------------------------------------------------------
    [INFO] BUILD SUCCESS
    [INFO] ------------------------------------------------------------------------
    [INFO] Total time:  45.021 s (Wall Clock)
    [INFO] Finished at: 2022-03-27T22:32:07+08:00
    [INFO] ------------------------------------------------------------------------
    ```

&ensp;&ensp;&ensp;&ensp;上述步骤的编译不会触发zero的测试流程，如果使用`mvnd clean package install`方式处理，会触发zero的测试流程，使得整个框架编译的时间拉长，所以不推荐`clean package install`方式，这种方式仅留给zero的研发人员使用。编译成功过后，您的开发环境的Maven库中就有了最新的zero版本，目前是`0.9.0-SNAPSHOT`，您就可以执行后续步骤了。

## 1.3. 「可选」zero插件环境

&ensp;&ensp;&ensp;&ensp;如果您在项目中使用了动态建模功能（启用`zero-atom`），此步骤是必须的，动态建模为高级功能，只有在引入主框架的场景下可启用，直接从中心仓库下载的依赖库中并不包含动态建模部分，由于此功能目前依然处于研发阶段，所以只有最新版可支持。

&ensp;&ensp;&ensp;&ensp;**操作步骤**如：

1. 执行Oracle依赖库的安装脚本（动态建模**编译必须**，运行可根据您的项目情况而定）
   
   ```shell
   # 进入 infix-oracle 项目目录
   ~/runtime/develop/vertx-zero(master) » cd vertx-pin/zero-vista/infix-oracle
   # 进入 Maven 本地安装目录
   ~/runtime/develop/vertx-zero/vertx-pin/zero-vista/infix-oracle(master) » cd maven
   # 执行安装脚本
   ~/runtime/develop/vertx-zero/vertx-pin/zero-vista/infix-oracle/maven(master) » ./install-oracle-jar.sh
   # 脚本内容如下
   # mvn install:install-file \
   #     -Dfile=ojdbc7-12.1.0.2.jar \
   #     -DgroupId=com.oracle \
   #     -DartifactId=ojdbc7 \
   #     -Dversion=12.1.0.2 
   #     -Dpackaging=jar
   ```
2. 在Maven窗口中添加新项目：
   ![](./_image/2022-03-28-05-40-21.png)
3. 导入项目`vertx-zero/vertx-pin/zero-vista/`（选择文件）
   ![](./_image/2022-03-28-05-45-35.png)
4. 导入项目后直接编译`zero-vista`：
   ```shell
   ~/runtime/develop/vertx-zero/vertx-pin/zero-vista(master) » mvn clean package install
   .....
   # 最终输出如下
   [INFO] ------------------------------------------------------------------------
   [INFO] Reactor Summary for 「vertx-vista」Scaffold Extension 0.9.0-SNAPSHOT:
   [INFO] 
   [INFO] 「vertx-vista」Scaffold Extension .................... SUCCESS [  1.693 s]
   [INFO] Scaffold Plugin: MySQL（infix-mysql） ................ SUCCESS [  6.121 s]
   [INFO] Scaffold Plugin: Oracle（infix-oracle） .............. SUCCESS [  3.783 s]
   [INFO] ------------------------------------------------------------------------
   [INFO] BUILD SUCCESS
   [INFO] ------------------------------------------------------------------------
   [INFO] Total time:  12.339 s
   [INFO] Finished at: 2022-03-28T05:46:15+08:00
   [INFO] ------------------------------------------------------------------------
   ```
5. 如此您就可以直接在项目中使用动态建模的DDL操作插件了，使用时只需要在`pom.xml`中引入下边片段即可（根据您使用的数据库选择合适的插件）：
    ```xml
        <!-- MySQL -->
        <dependency>
            <groupId>cn.vertxup</groupId>
            <artifactId>infix-mysql</artifactId>
            <version>${zero.version}</version>
        </dependency>
        <!-- Oracle -->
        <dependency>
            <groupId>cn.vertxup</groupId>
            <artifactId>infix-oracle</artifactId>
            <version>${zero.version}</version>
        </dependency>
    ```

## 1.4. 「可选」Github安全设置

> 可直接参考<https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token>

&ensp;&ensp;&ensp;&ensp;由于Github站点升级，当你作为Coordinator加入到项目开发时，新版本已不支持**用户名/密码**方式拉取代码，而是需要在您的账号中生成一个个人的`access_token`，拉取项目代码时需要使用该`access_token`执行代码拉取。

&ensp;&ensp;&ensp;&ensp;其**操作步骤**如下：


1. 登录您的Github个人账号空间，右上角选择**Settings**菜单：
   ![](./_image/2022-03-28-06-09-08.png)
2. 选择左边菜单中最下边的**Developer Settings**：
   ![](./_image/2022-03-28-06-13-40.png)
3. 选择左边菜单**Personal access tokens**，然后点击**Generate new token**按钮
   ![](./_image/2022-03-28-06-15-14.png)
4. 勾选好您所需的权限后直接点击**Genarate token**按钮：
   ![](./_image/2022-03-28-06-17-18.png)
5. 在结果页记录下您的个人token：
   ![](./_image/2022-03-28-06-18-11.png)

6. 进入您的项目环境中，执行如下**操作步骤**进行库关联，先查看目前的远程库版本：

    ```shell
    ~/runtime/develop/vertx-zero(master) » git remote -v
    origin  https://github.com/silentbalanceyh/vertx-zero.git (fetch)
    origin  https://github.com/silentbalanceyh/vertx-zero.git (push)
    ```
7. 您的远程库名称为`origin`，执行如下命令：
   
    ```shell
    ~/runtime/develop/vertx-zero(master) » git remote set-url origin \
        https://<TOKEN>@github.com/silentbalanceyh/vertx-zero.git 
    ```
    注意上述命令的格式，主要是您的token的位置，介于`https://`和`github.com`之间，并且以`@`结尾。
8. 再次查看您的远程库：
    ![](./_image/2022-03-28-06-25-24.png)

&ensp;&ensp;&ensp;&ensp;如此您作为项目的一个Coordinator，基本设置就完成了，当然在后续步骤中您可以直接使用`git clone https://<Token>@<Repo>`的方式拉取代码，**则 6 ~ 8 步骤可省略**。

## 1.5. 项目后端

&ensp;&ensp;&ensp;&ensp;如果是自己从头搭建zero脚手架，则使用**新建**流程，若是导入已经搭建好的项目则使用**导入**流程。

### 1.5.1. 新建

### 1.5.2. 导入

## 1.6. 项目前端

### 1.6.1. 新建

### 1.6.2. 导入

## 1.7. 启动流程



# 「贰」生产部署

### 1.3.2. 命令工具

### 1.3.3. 后端启动

### 1.3.4. 前端启动

# 「叁」核心配置

### 2.1.1. 端口号和跨域

### 2.1.2. 建库/导入

### 2.1.3. 工作流引擎

### 2.1.4. 开发中心

### 2.1.5. 常用命令

### 2.1.6. 集成配置

# 「肆」业务配置

### 2.2.1. 文档管理

### 2.2.2. 环境管理

### 2.2.3. 模块化配置

### 2.2.4. Auditor配置

### 2.2.5. 调试开关
